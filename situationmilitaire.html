<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Mise en situation Militaire</title>
  <link rel="icon" href="https://i.imgur.com/cYoRkpp.png">
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:20px;background:#f8f9fa;}
    .container{max-width:860px;margin:0 auto;background:white;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.15);}
    .logo{width:100px;height:100px;border-radius:50%;object-fit:cover;border:3px solid #003087;margin:0 auto 20px;display:block;}
    h1{text-align:center;color:#003087;margin-bottom:8px;}
    .subtitle{text-align:center;color:#555;margin-bottom:30px;}
    label{display:block;margin:18px 0 6px;font-weight:bold;}
    input,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;font-size:1rem;}
    button{display:block;margin:50px auto 0;padding:16px 80px;font-size:1.3rem;background:#c8102e;color:white;border:none;border-radius:8px;cursor:pointer;}
    button:hover{background:#a00d24;}
    #loading{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;color:white;font-size:2rem;flex-direction:column;justify-content:center;align-items:center;}
    .spinner{width:80px;height:80px;border:10px solid #fff;border-top:10px solid #c8102e;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:30px;}
    #result{display:none;margin-top:40px;padding:25px;background:#e8f4fd;border:2px solid #003087;border-radius:10px;text-align:center;font-size:1.4rem;line-height:1.5;}
    @keyframes spin{to{transform:rotate(360deg);}}
  </style>
</head>
<body>

<div class="container">
  <img src="https://i.imgur.com/cYoRkpp.png" alt="Logo" class="logo">
  <h1>Test Mise en Situation – Militaire</h1>
  <p class="subtitle">20 questions – Total sur 20 points</p>

  <form id="testForm">
    <label for="prenom">Prénom :</label>
    <input type="text" id="prenom" name="prenom" required>

    <label for="nom">Nom :</label>
    <input type="text" id="nom" name="nom" required>

    <label for="numero">Numéro de candidat / Matricule :</label>
    <input type="text" id="numero" name="numero" required>

    <!-- Questions -->
    <label>1. Un subordonné arrive systématiquement en retard. Première action ?</label><textarea name="q1" rows="3" required></textarea>
    <label>2. Conflit violent entre deux soldats sous tes ordres. Première action ?</label><textarea name="q2" rows="3" required></textarea>
    <label>3. En patrouille, un membre semble désorienté et fatigué. Décision ?</label><textarea name="q3" rows="3" required></textarea>
    <label>4. Ordre que tu juges dangereux et mal préparé. Réaction ?</label><textarea name="q4" rows="3" required></textarea>
    <label>5. Soldat refuse un ordre légitime. Réaction ?</label><textarea name="q5" rows="3" required></textarea>
    <label>6. Membre de l'unité a consommé de l'alcool avant mission. Action ?</label><textarea name="q6" rows="3" required></textarea>
    <label>7. Chef te reproche publiquement une erreur non commise. Attitude ?</label><textarea name="q7" rows="3" required></textarea>
    <label>8. Répartir rations insuffisantes pour tout le monde. Méthode ?</label><textarea name="q8" rows="3" required></textarea>
    <label>9. Soldat victime de brimades. Démarche ?</label><textarea name="q9" rows="3" required></textarea>
    <label>10. Véhicule en panne loin de tout secours. Première décision ?</label><textarea name="q10" rows="3" required></textarea>
    <label>11. Monter la garde avec hommes fatigués. Répartition créneaux ?</label><textarea name="q11" rows="3" required></textarea>
    <label>12. Demande de falsifier un rapport pour protéger quelqu’un. Réponse ?</label><textarea name="q12" rows="3" required></textarea>
    <label>13. Matériel abîmé par mauvaise utilisation. Action ?</label><textarea name="q13" rows="3" required></textarea>
    <label>14. Exercice – un homme légèrement blessé. Décision ?</label><textarea name="q14" rows="3" required></textarea>
    <label>15. Choisir entre deux candidats pour mission délicate. Critères ?</label><textarea name="q15" rows="3" required></textarea>
    <label>16. Signalement de harcèlement. Démarche ?</label><textarea name="q16" rows="3" required></textarea>
    <label>17. Motiver équipe démoralisée après échec. Que dis-tu ?</label><textarea name="q17" rows="3" required></textarea>
    <label>18. Ordre contradictoire avec la veille. Que fais-tu ?</label><textarea name="q18" rows="3" required></textarea>
    <label>19. Deux soldats en train de se battre. Intervention ?</label><textarea name="q19" rows="3" required></textarea>
    <label>20. Gérer départ en permission en situation tendue. Organisation ?</label><textarea name="q20" rows="3" required></textarea>

    <button type="submit">Valider et envoyer</button>
  </form>

  <div id="result"></div>
</div>

<div id="loading">
  <div class="spinner"></div>
  <div>Envoi en cours… 5 secondes</div>
</div>

<script>
// ────────────────────────────────────────────────
// MOTS-CLÉS PAR QUESTION (inspirés de doctrine militaire, gestion de crise, discipline, leadership)
// 1 point si ≥ 3 mots-clés sont présents dans la réponse
// ────────────────────────────────────────────────
const motsCles = {
  q1:  ["sanction", "avertissement", "discussion", "entretien", "rappel", "discipline", "retard", "hiérarchie"],
  q2:  ["séparer", "écoute", "médiation", "sanction", "rapport", "hiérarchie", "calme", "autorité"],
  q3:  ["repos", "relève", "évaluation", "sécurité", "médecin", "mission", "fatigue", "alerte"],
  q4:  ["refuser", "remonter", "hiérarchie", "danger", "sécurité", "rapport", "alternative", "objection"],
  q5:  ["sanction", "discipline", "entretien", "ordre", "refus", "légitime", "hiérarchie", "explication"],
  q6:  ["retirer", "rapport", "sanction", "alcool", "mission", "sécurité", "contrôle", "hiérarchie"],
  q7:  ["écoute", "calme", "respect", "réponse", "discussion", "privé", "humilité", "amélioration"],
  q8:  ["équité", "priorité", "besoin", "partage", "hiérarchie", "rapport", "transparence", "rationnement"],
  q9:  ["écoute", "enquête", "rapport", "protection", "hiérarchie", "sanction", "soutien", "discrétion"],
  q10: ["sécurité", "alerte", "réparation", "demande", "radio", "position", "attente", "évaluation"],
  q11: ["priorité", "repos", "rotation", "fatigue", "efficacité", "sécurité", "équité", "surveillance"],
  q12: ["refuser", "rapport", "hiérarchie", "intégrité", "loyauté", "éthique", "sanction", "discipline"],
  q13: ["rapport", "réparation", "formation", "sanction", "contrôle", "responsabilité", "prévention"],
  q14: ["évacuation", "secours", "alerte", "premiers soins", "mission", "sécurité", "hiérarchie", "rapport"],
  q15: ["compétence", "expérience", "fiabilité", "motivation", "équipe", "mission", "critères", "équilibre"],
  q16: ["écoute", "enquête", "rapport", "protection", "hiérarchie", "confidentialité", "soutien", "sanction"],
  q17: ["discours", "exemple", "confiance", "solidarité", "analyse", "leçon", "rebond", "motivation"],
  q18: ["hiérarchie", "rapport", "clarification", "obéissance", "sécurité", "initiative", "alternative"],
  q19: ["séparer", "calme", "écoute", "sanction", "rapport", "médiation", "autorité", "discipline"],
  q20: ["contrôle", "planning", "priorité", "sécurité", "rotation", "mission", "équité", "rapport"]
};

const form = document.getElementById('testForm');
const loading = document.getElementById('loading');
const resultDiv = document.getElementById('result');

form.addEventListener('submit', async e => {
  e.preventDefault();

  // Calcul du score basé sur présence de mots-clés
  let score = 0;
  for (let i = 1; i <= 20; i++) {
    const key = 'q' + i;
    const reponse = (form.elements[key]?.value || "").trim().toLowerCase();

    const keywords = motsCles[key] || [];
    let count = 0;

    for (const mot of keywords) {
      if (reponse.includes(mot.toLowerCase())) {
        count++;
      }
    }

    // 1 point si au moins 3 mots-clés pertinents sont présents
    if (count >= 3) {
      score += 1;
    }
  }

  loading.style.display = 'flex';
  form.querySelectorAll('input,textarea,button').forEach(el => el.disabled = true);

  try {
    const formData = new FormData();
    formData.append('prenom',   form.prenom.value.trim());
    formData.append('nom',      form.nom.value.trim());
    formData.append('numero',   form.numero.value.trim());
    formData.append('score',    score);
    formData.append('test_type','Mise en situation');

    const response = await fetch('https://script.google.com/macros/s/AKfycbz-B7FaLn-OiTeZbPM1HaxAYlRVaLA4E24eA3zu3pio4MLKDqeL4598Az5SMJuYkW6_/exec', {
      method: 'POST',
      body: formData
    });

    await new Promise(r => setTimeout(r, 5000));

    if (response.ok) {
      resultDiv.innerHTML = `
        <strong>Résultat pour ${form.prenom.value.trim()} ${form.nom.value.trim()}</strong><br>
        <span style="font-size:2.4rem;color:#c8102e;font-weight:bold;">
          Score : ${score} / 20
        </span><br>
        <small>Score calculé automatiquement via mots-clés (doctrine militaire). Les réponses détaillées peuvent être affinées manuellement.</small>
      `;
      resultDiv.style.display = 'block';
      form.reset();
    } else {
      alert('Erreur lors de l’envoi (statut ' + response.status + ')');
    }
  } catch (err) {
    alert('Erreur réseau : ' + err.message);
  } finally {
    loading.style.display = 'none';
    form.querySelectorAll('input,textarea,button').forEach(el => el.disabled = false);
    // window.location.reload();   ← commenté pour garder le résultat visible
  }
});
</script>

</body>
</html>
