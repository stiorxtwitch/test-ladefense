<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Entrée Officier</title>
  <link rel="icon" href="https://i.imgur.com/cYoRkpp.png">
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:20px;background:#f8f9fa;}
    .container{max-width:860px;margin:0 auto;background:white;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.15);}
    .logo{width:100px;height:100px;border-radius:50%;object-fit:cover;border:3px solid #003087;margin:0 auto 20px;display:block;}
    h1{text-align:center;color:#003087;margin-bottom:8px;}
    .subtitle{text-align:center;color:#555;margin-bottom:30px;}
    label{display:block;margin:18px 0 6px;font-weight:bold;}
    input,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;font-size:1rem;}
    button{display:block;margin:50px auto 0;padding:16px 80px;font-size:1.3rem;background:#c8102e;color:white;border:none;border-radius:8px;cursor:pointer;}
    button:hover{background:#a00d24;}
    #loading{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;color:white;font-size:2rem;flex-direction:column;justify-content:center;align-items:center;}
    .spinner{width:80px;height:80px;border:10px solid #fff;border-top:10px solid #c8102e;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:30px;}
    #result{display:none;margin-top:40px;padding:25px;background:#e8f4fd;border:2px solid #003087;border-radius:10px;text-align:center;font-size:1.4rem;line-height:1.5;}
    @keyframes spin{to{transform:rotate(360deg);}}
  </style>
</head>
<body>

<div class="container">
  <img src="https://i.imgur.com/cYoRkpp.png" alt="Logo" class="logo">
  <h1>Test Entrée Officier</h1>
  <p class="subtitle">20 questions – Total sur 20 points</p>

  <form id="testForm">
    <label for="prenom">Prénom :</label>
    <input type="text" id="prenom" name="prenom" required>

    <label for="nom">Nom :</label>
    <input type="text" id="nom" name="nom" required>

    <label for="numero">Numéro de candidat / Matricule :</label>
    <input type="text" id="numero" name="numero" required>

    <!-- Questions -->
    <label>1. Résoudre l’équation : 2x² – 12x + 16 = 0</label>
    <input type="text" name="q1" required placeholder="forme factorisée ou réduite ex: 2(x-2)(x-4) ou x=2; x=4">

    <label>2. Calculer la limite quand x→0 de (sin(5x))/x</label>
    <input type="text" name="q2" required placeholder="ex: 5">

    <label>3. Différence entre stratégie et tactique militaire ?</label>
    <textarea name="q3" rows="3" required></textarea>

    <label>4. Quel est le rôle principal d’un officier subalterne en opérations ?</label>
    <textarea name="q4" rows="3" required></textarea>

    <label>5. 18 % de 450 = ?</label>
    <input type="number" name="q5" required>

    <label>6. PGCD et PPCM de 60 et 84 ?</label>
    <input type="text" name="q6" required placeholder="ex: PGCD=12, PPCM=420">

    <label>7. Quelle est la fonction de l’état-major dans une brigade ?</label>
    <textarea name="q7" rows="3" required></textarea>

    <label>8. Résoudre : log₂(32) + log₂(4) = ?</label>
    <input type="number" name="q8" required>

    <label>9. Nomme les trois niveaux de planification militaire</label>
    <input type="text" name="q9" required placeholder="ex: stratégique, opératif, tactique">

    <label>10. Que signifie l’acronyme OPLAN ?</label>
    <input type="text" name="q10" required placeholder="ex: Operations Plan">

    <label>11. Calculer la dérivée de f(x) = 3x³ – 5x² + 7</label>
    <input type="text" name="q11" required placeholder="ex: 9x² - 10x">

    <label>12. Différence entre ordre permanent et ordre d’opération ?</label>
    <textarea name="q12" rows="3" required></textarea>

    <label>13. 5! / 3! = ?</label>
    <input type="number" name="q13" required>

    <label>14. Principe de base de la « manœuvre » selon Clausewitz ?</label>
    <textarea name="q14" rows="2" required></textarea>

    <label>15. Surface d’un cercle de rayon 7 cm ? (≈3,14)</label>
    <input type="number" step="0.1" name="q15" required placeholder="ex: 153.9">

    <label>16. Rôle du J5 dans un état-major interarmées ?</label>
    <input type="text" name="q16" required placeholder="ex: planification">

    <label>17. Résoudre le système : 2x + 3y = 12 et x – y = 1</label>
    <input type="text" name="q17" required placeholder="ex: x=3, y=2">

    <label>18. Finalité de l’« appréciation de situation » ?</label>
    <textarea name="q18" rows="3" required></textarea>

    <label>19. Volume d’une sphère de rayon 6 cm ? (≈4/3πr³)</label>
    <input type="number" step="0.1" name="q19" required placeholder="ex: 904.8">

    <label>20. Nomme trois qualités essentielles d’un officier chef de section</label>
    <textarea name="q20" rows="3" required></textarea>

    <button type="submit">Valider et envoyer</button>
  </form>

  <div id="result"></div>
</div>

<div id="loading">
  <div class="spinner"></div>
  <div>Envoi en cours… 5 secondes</div>
</div>

<script>
// ────────────────────────────────────────────────
// BONNES RÉPONSES (ADAPTEZ-LES EXACTEMENT À VOS CRITÈRES)
// Note : les réponses textuelles sont sensibles à la casse ici
// Pour les questions ouvertes (q3,q4,q7,...), la note est donnée manuellement ou 0 par défaut
// ────────────────────────────────────────────────
const bonnesReponses = {
  q1:  "2(x-2)(x-4)",     // ou "x=2; x=4" ou "x=2 x=4" – adapte selon tolérance
  q2:  "5",
  q5:  "81",
  q6:  "pgcd=12, ppcm=420", // tolérance sur l'ordre et espaces
  q8:  "7",
  q9:  "stratégique opératif tactique", // tolérance sur l'ordre
  q10: "operations plan",
  q11: "9x²-10x",
  q13: "20",
  q15: "153.9", // ou "154" selon approximation
  q17: "x=3 y=2", // ou "x=3, y=2"
  q19: "904.8"    // ou "905"
  // Les questions textuelles ouvertes (q3,q4,q7,q12,q14,q16,q18,q20) → 0 point automatique ici
  // Tu peux les noter manuellement dans le sheet si tu veux
};

const form = document.getElementById('testForm');
const loading = document.getElementById('loading');
const resultDiv = document.getElementById('result');

form.addEventListener('submit', async e => {
  e.preventDefault();

  // Calcul du score
  let score = 0;
  for (let i = 1; i <= 20; i++) {
    const key = 'q' + i;
    let reponseUser = (form.elements[key]?.value || "").trim().toLowerCase().replace(/\s+/g, ' ');

    // Normalisation pour certaines réponses (ex: espaces, virgules)
    if (key === 'q6') reponseUser = reponseUser.replace(/pgcd|ppcm/gi, m => m.toLowerCase());
    if (key === 'q9') reponseUser = reponseUser.replace(/,/g, ' ');

    const bonne = (bonnesReponses[key] || "").toLowerCase();

    if (bonne && reponseUser.includes(bonne)) {   // .includes pour tolérance partielle
      score += 1;
    }
  }

  loading.style.display = 'flex';
  form.querySelectorAll('input,textarea,button').forEach(el => el.disabled = true);

  try {
    const formData = new FormData();
    formData.append('prenom',   form.prenom.value.trim());
    formData.append('nom',      form.nom.value.trim());
    formData.append('numero',   form.numero.value.trim());
    formData.append('score',    score);
    formData.append('test_type','Test Entrée OFF');

    const response = await fetch('https://script.google.com/macros/s/AKfycbzpurjdSmV9PmI74c2f45O9srmSKmd6MJ6adcu8i6yE54M6TKU5bYJoYiTlxpikVssg/exec', {
      method: 'POST',
      body: formData
    });

    await new Promise(r => setTimeout(r, 5000));

    if (response.ok) {
      resultDiv.innerHTML = `
        <strong>Résultat pour ${form.prenom.value.trim()} ${form.nom.value.trim()}</strong><br>
        <span style="font-size:2.4rem;color:#c8102e;font-weight:bold;">
          Score : ${score} / 20
        </span>
      `;
      resultDiv.style.display = 'block';
      form.reset();
    } else {
      alert('Erreur envoi (statut ' + response.status + ')');
    }
  } catch (err) {
    alert('Erreur réseau : ' + err.message);
  } finally {
    loading.style.display = 'none';
    form.querySelectorAll('input,textarea,button').forEach(el => el.disabled = false);
    // window.location.reload();   ← commenté → on garde le résultat visible
  }
});
</script>

</body>
</html>
